# 3D Viewer

<img src="../static/3d/01_intro_3.gif" alt="intro" width="600px">

Every _nifti_ file has the `3D View` button that opens a new window that allows you to quickly visualize and inspect the anatomy and quality of your dataset. The panel allows you to scroll through slices, switch the render mode or intensity ranges.

```{admonition} Visual settings
:class: tip
* Any change you make only affects the visualization, it won't affect the data. So feel free to explore what parameters work better for your visualization. 
* You can zoom in and out with the scroll wheel. You can rotate the figure by clicking and dragging.
* It requires GPU (integrated or discreted) for graphics smooth interaction. Check your Task Manager, usually in the _Performance_ window to check if your sytem counts with one (GPU **0** usually indicates an integrated GPU). If your system doesn't count with one, the 3D View will remain empty.
* At the end of the Settings Panel you'll find a summary of your visualization parameters, so you can save them for future visualizations.

[FIGURE: summary]

```

* **Panel Placement:** You can decide the placement of the setting panel within the screen (`Bottom`, `Right` or `Left`). 
* **Aggregation:** Depending on your type of sequence, you have access to different types of aggregation. As many NIfTI files are 4D, aggregation tells how to collapse them into a single 3D render.
  * **Anatomical (anat) & Fieldmap: (fmap):** the only available type of aggregation is `Intensity`, as there is not a 4th dimension. 
  * **Diffusion (dwi) & Functional (func):** you can choose different aggregation types: `Mean value`, `RMS DTI` (Root Mean Square), `Max value`, `First volume`. Mean and RMS aggregation are similar, Max value will help you spot outliers. 
  
* **Rendering Mode:** You can decide in-between `Point Cloud` or `Surface Mesh`, they have different adjustable parameters.
  * `Point Cloud`: Renders visible scattered voxels as points. You can control the following visual parameters:
    * `Threshold` (0 1): Minimun normalised intensity (see Color bar) to show as a point. If it is too high, the visualization will be black-empty; lower values are preferable, but if it's too low you'll see the entire volume box.
    * `Point size`: visual diameter of each point. Larger sizes fill gaps and make surfaces look more solid. If you double click, it will go maximun.


<img src="../static/3d/02_threshold.gif" alt="intro" width="600px">

     
   * `Surface Mesh`: extracts an iso-surface and displays it as three dimensional triangles that connect points with similar values.
     * `Iso level` (0-1): Target intensity level for the iso-surface. Lower levels capture better softer tissues, and higher levels bone structures.

An isosurface is a three-dimensional analog of an isoline. It is a surface that represents points of a constant value (e.g. pressure, temperature, velocity, density) within a volume of space; in other words, it is a level set of a continuous function whose domain is 3-space.





Rendering options:
* Colormap: "select the matplotlib for voxel intensities" The colour bar at the bottom will change and will show you the limit values, the edges. Bone is recommended because it's like the recording view (?).
* Opacity[0 1]: "Global alpha applied to rendering points or surface mesh", very low is very transparent, 1 is not transparent at all.
* Colour Intensity [0.1 2]: "Scale factor applied to RGB values after colormpa lookup", to make it clear.
* Maximun points: "Upper bound on voxes displayed on point-cloud mode" the higher the better but it might slow down your pc. Points to render, the higher, the more define, maximun: 20 million.
* Downsample step: "Manual voxel stride applied before rendering" 0 is automatic, more is recommended, it also slows down your pc. 1 is "native" (?), 2+ lows the resolution.
* Marchings cubes step: "Sampling stirde for marchin cubes when computing iso-surfaces". Only for surface mesh (render mode).  It's another type of dowsampling, 2 they are bigger but the resolution is lower. Larger = faster but blockier; smaller = smoother but heavier.
* Show axes: It will show x, y and z axes
* Axis thickness: Line width of anatomical axes
* Show axis label: Superior, Posterior, Anterior, Inferior, Right, Left

Slice planes: choose 1, schroll through slices, useful for state or tecnic against (?)
* Sagittal: Left - Right toggle
* Coronal: Posterior - Anterior toggel
* Axial: Inferior - Superior toggel

Lightning [do a gif]
* Enable lightning: only possible to disable and edit in the surface mesh. 
* Azimuth: Horizontal direction of the light source relative to the mesh.
* Elevation: Vertical angle of the light source relative to the mesh.
* Intensity: Diffuse lightning strength [0.1-3]. Ambient light stays constant.

Summary: At the end there is a summary with all the values you used:
- Point cloud (number of voxels), theshold value, opacity and point size
- Downsample step 1 (auto 0 / manual if >0)
- ~ total voxes > threshold 5,586 (value)
- Lightning enabled (default and not disable for point cloud)

```{admonition} Quick visualization
:class: dropdown

* Low the `Threshold` until skull/skin becomes continuous.
* If it's speckly, increase `Point Size` or decrease `Threshold slightly.
* If the mesh looks blobby, raise the `Iso level` slightly.
* If it looks jagged, reduce the `marching-cubes step`.

```


