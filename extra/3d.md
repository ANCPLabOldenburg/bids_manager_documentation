# 3D Viewer

<img src="../static/3d/01_intro_3.gif" alt="intro" width="600px">

Every _nifti_ file has the `3D View` button that opens a new window that allows you to quickly visualize and inspect the anatomy and quality of your dataset. The panel allows you to scroll through slices, switch the render mode or intensity ranges.

```{admonition} Visual settings
:class: tip
* Any change you make only affects the visualization, it won't affect the data. So feel free to explore what parameters work better for your visualization. 
* You can zoom in and out with the scroll wheel. You can rotate the figure by clicking and dragging.
* It requires GPU, integrated or discreted GPU: procesadores con modulos dedicados integrados.

```
* **Settings Panel:** You can decide the placement of the setting panel within the screen with the **Panel Placement** option (`Bottom`, `Right` or `Left`). At the end of the Settings Panel you'll find a summary of your visualization parameters, so you can save them for future sessions.

[FIGURE REQUIRED: summary]

* **Aggregation:** Depending on your type of sequence, you have access to different types of aggregation.
 * **Anatomical (anat) & Fieldmap: (fmap):** the only available type of aggregation is `intensity`.
 * **Diffusion (dwi) & Functional (func):** you can choose `Mean value`, `Max value`, `First volume`, `RMS DTI`.
   * `Mean value`: basic contrast, good for checking coverage.
   * `Max value` & `RMS DTI`: exaggerates outliers, good to spot artifacts.
   * `First volume`: Useful to inspect the exact reference frame.

* **Rendering Mode:** You can decide in-between `Point Cloud` or `Surface Mesh`, they have different adjustable parameters.
  * `Point Cloud`: Scattered voxels. You can modify the
    * Threshold [0 1]: "minimun normalised intensity included in the rendering" (point cloud). Thershold is similar to intensity, if they are too high you won't see anything. Once you put it lower, you start being able to see structures. [make a gif] But if you make it too low, you get to this cube (the square is... missing word)
      * Point Size: "Marker diameter for point-cloud rendering." (point cloud)
  
   * `Surface Mesh`: iso-surface.
     * Iso level: "iso surface level within the normalized volume" (0-1) (surface mesh)





Rendering options:
* Colormap: "select the matplotlib for voxel intensities" The colour bar at the bottom will change and will show you the limit values, the edges. Bone is recommended because it's like the recording view (?).
* Opacity[0 1]: "Global alpha applied to rendering points or surface mesh", very low is very transparent, 1 is not transparent at all.
* Colour Intensity [0.1 2]: "Scale factor applied to RGB values after colormpa lookup", to make it clear.
* Maximun points: "Upper bound on voxes displayed on point-cloud mode" the higher the better but it might slow down your pc. Points to render, the higher, the more define, maximun: 20 million.
* Downsample step: "Manual voxel stride applied before rendering" 0 is automatic, more is recommended, it also slows down your pc. 1 is "native" (?), 2+ lows the resolution.
* Marchings cubes step: "Sampling stirde for marchin cubes when computing iso-surfaces". Only for surface mesh (render mode).  It's another type of dowsampling, 2 they are bigger but the resolution is lower.
* Show axes: It will show x, y and z axes
* Axis thickness: Line width of anatomical axes
* Show axis label: Superior, Posterior, Anterior, Inferior, Right, Left

Slice planes: choose 1, schroll through slices, useful for state or tecnic against (?)
* Sagittal: Left - Right toggle
* Coronal: Posterior - Anterior toggel
* Axial: Inferior - Superior toggel

Lightning [do a gif]
* Enable lightning: only possible to disable and edit in the surface mesh. 
* Azimuth: Horizontal direction of the light source relative to the mesh.
* Elevation: Vertical angle of the light source relative to the mesh.
* Intensity: Diffuse lightning strength [0.1-3]. Ambient light stays constant.

Summary: At the end there is a summary with all the values you used:
- Point cloud (number of voxels), theshold value, opacity and point size
- Downsample step 1 (auto 0 / manual if >0)
- ~ total voxes > threshold 5,586 (value)
- Lightning enabled (default and not disable for point cloud)

```{admonition} Quick visualization
:class: dropdown

1. Drag the `Threshold` to a low value.
2. Increase the `Colour Intensity`
3. Increase the `Maximun Points`
4. Increase the `Downsample step`
5. Choose a `Slice planes` and explore the toggles.

```


